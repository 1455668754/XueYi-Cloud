<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xueyi.system.cache.mapper.SysCacheInitMapper">

    <resultMap type="CacheInitVo" id="CacheInitResult">
        <result property="enterpriseId"     column="tenant_id"      />
        <result property="systemId"         column="system_id"      />
        <collection  property="menuSet"    javaType="java.util.Set" resultMap="menuResult"   />
        <collection  property="systemSet"  javaType="java.util.Set" resultMap="systemResult" />
    </resultMap>

    <resultMap type="SysMenu" id="menuResult">
        <id     property="menuId"           column="menu_menu_id"        />
        <result property="systemId"         column="menu_system_id"      />
        <result property="menuName"         column="menu_menu_name"      />
        <result property="parentId"         column="menu_parent_id"      />
        <result property="parentName"       column="menu_parent_name"    />
        <result property="path"             column="menu_path"           />
        <result property="component"        column="menu_component"      />
        <result property="query"          	column="menu_query"          />
        <result property="isCommon"         column="menu_is_common"      />
        <result property="isChange"         column="menu_is_change"      />
        <result property="isFrame"          column="menu_is_frame"       />
        <result property="isCache"          column="menu_is_cache"       />
        <result property="menuType"         column="menu_menu_type"      />
        <result property="visible"          column="menu_visible"        />
        <result property="perms"            column="menu_perms"          />
        <result property="icon"             column="menu_icon"           />
        <result property="status"           column="menu_status"         />
        <result property="sort"             column="menu_sort"           />
    </resultMap>

    <resultMap type="SysSystem" id="systemResult">
        <id     property="systemId"         column="system_system_id"   />
        <result property="name"             column="system_name"        />
        <result property="imageUrl"         column="system_image_url"   />
        <result property="type"             column="system_type"        />
        <result property="route"            column="system_route"       />
        <result property="isCommon"         column="system_is_common"   />
        <result property="isChange"         column="system_is_change"   />
        <result property="isNew"            column="system_is_new"      />
        <result property="visible"          column="system_visible"     />
        <result property="sort"       		column="system_sort"        />
        <result property="status"       	column="system_status"      />
        <result property="remark" 			column="system_remark" 	    />
    </resultMap>
    
    <sql id="menuCacheVo">
        select distinct m.tenant_id, m.menu_id as menu_menu_id, m.system_id as menu_system_id, m.menu_name as menu_menu_name, if(m.parent_id = 0, m.system_id, m.parent_id) as menu_parent_id, m.path as menu_path, m.component as menu_component, m.query as menu_query, m.is_common as menu_is_common,
               m.is_change as menu_is_change, m.is_frame as menu_is_frame, m.is_cache as menu_is_cache, m.menu_type as menu_menu_type, m.visible as menu_visible, m.status as menu_status, ifnull(m.perms, '') as menu_perms, m.icon as menu_icon, m.sort as menu_sort
        from sys_menu m
    </sql>

    <sql id="systemCacheVo">
        select distinct s.tenant_id, s.system_id as system_system_id, s.name as system_name, s.image_url as system_image_url, s.type as system_type, s.route as system_route, s.is_common as system_is_common,
                        s.is_change as system_is_change, s.is_new as system_is_new, s.visible as system_visible, s.status as system_status, s.remark as system_remark, s.sort as system_sort
        from xy_system s
    </sql>

    <sql id="systemMenuCacheVo">
        select distinct m.tenant_id, m.system_id, m.menu_id as menu_menu_id, m.system_id as menu_system_id, m.menu_name as menu_menu_name, if(m.parent_id = 0, m.system_id, m.parent_id) as menu_parent_id, m.path as menu_path, m.component as menu_component, m.query as menu_query, m.is_common as menu_is_common,
                        m.is_change as menu_is_change, m.is_frame as menu_is_frame, m.is_cache as menu_is_cache, m.menu_type as menu_menu_type, m.visible as menu_visible, m.status as menu_status, ifnull(m.perms, '') as menu_perms, m.icon as menu_icon, m.sort as menu_sort
        from sys_menu m
    </sql>

    <select id="mainSelectMenuCacheList" parameterType="CacheInitVo" resultMap="CacheInitResult">
        <include refid="menuCacheVo"/>
        where m.status = 0 and m.del_flag = 0
        order by m.sort
    </select>

    <select id="mainSelectSystemCacheList" parameterType="CacheInitVo" resultMap="CacheInitResult">
        <include refid="systemCacheVo"/>
        where s.status = 0 and s.del_flag = 0
        order by s.sort
    </select>

    <select id="mainSelectSystemMenuCacheList" parameterType="CacheInitVo" resultMap="CacheInitResult">
        <include refid="systemMenuCacheVo"/>
        where m.menu_type in ('M', 'C') and m.status = 0 and m.del_flag = 0
        order by m.sort
    </select>

</mapper>