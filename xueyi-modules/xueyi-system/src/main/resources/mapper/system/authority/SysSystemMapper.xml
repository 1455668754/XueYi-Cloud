<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xueyi.system.authority.mapper.SysSystemMapper">

    <resultMap type="SysSystem" id="SysSystemResult">
        <id     property="systemId"         column="system_id"   />
        <result property="systemName"       column="system_name" />
        <result property="imageUrl"         column="image_url"   />
        <result property="type"             column="type"        />
        <result property="route"            column="route"       />
        <result property="isMain"           column="is_main"     />
        <result property="sort"       		column="sort"        />
        <result property="status"       	column="status"      />
        <result property="createBy"   		column="create_by"   />
        <result property="createName"   	column="create_name" />
        <result property="createTime" 		column="create_time" />
        <result property="updateBy"   		column="update_by"   />
        <result property="updateName"   	column="update_name" />
        <result property="updateTime" 		column="update_time" />
        <result property="remark" 			column="remark" 	 />
    </resultMap>

    <sql id="selectVo">
        select s.system_id, s.system_name, s.image_url, s.type, s.route, s.sort, s.status, s.create_by, s.create_time, s.update_by, s.update_time, s.remark
        from xy_system s
    </sql>

    <sql id="RouteVo">
        select distinct s.system_id, s.system_name, s.image_url, s.type, s.route, s.sort, s.status, s.remark
        from xy_system s
                 left join sys_role_system_menu rsm on rsm.system_menu_id = s.system_id
                 left join sys_dept_role dr on dr.role_id = rsm.role_id
                 left join sys_post_role pr on pr.role_id = rsm.role_id
                 left join sys_user_role ur on ur.role_id = rsm.role_id
                 left join sys_user u on u.dept_id = dr.dept_id or u.post_id = pr.post_id or u.user_id = ur.user_id
                 left join sys_role r on r.role_id = dr.role_id or r.role_id = pr.role_id or r.role_id = ur.role_id
    </sql>

    <select id="selectSystemViewAdminList" parameterType="SysSystem" resultMap="SysSystemResult">
        <include refid="RouteVo"/>
        where s.status = '0'
        <!-- 数据范围过滤 -->
        ${params.dataScope}
        order by s.sort
    </select>

    <select id="selectSystemViewList" parameterType="SysSystem" resultMap="SysSystemResult">
        <include refid="RouteVo"/>
        where u.user_id = #{params.userId} and s.status = '0'
        <!-- 数据范围过滤 -->
        ${params.dataScope}
        order by s.sort
    </select>

    <select id="selectSystemList" parameterType="SysSystem" resultMap="SysSystemResult">
        <include refid="selectVo"/>
        where 1=1
        <if test="systemName != null  and systemName != ''"> and s.system_name like concat('%', #{systemName}, '%')</if>
        <if test="type != null  and type != ''"> and s.type = #{type}</if>
        <if test="route != null  and route != ''"> and s.route = #{route}</if>
        <if test="sort != null "> and s.sort = #{sort}</if>
        <if test="status != null  and status != ''"> and s.status = #{status}</if>
        <!-- 数据范围过滤 -->
        ${params.dataScope}
        order by s.sort
    </select>

    <select id="selectSystemById" parameterType="SysSystem" resultMap="SysSystemResult">
        <include refid="selectVo"/>
        where s.system_id = #{systemId}
        <!-- 数据范围过滤 -->
        ${params.dataScope}
    </select>

    <insert id="insertSystem" parameterType="SysSystem">
        insert into xy_system
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="Id != null and Id != 0">                         system_id               ,</if>
            <if test="systemName != null and systemName != ''">        system_name             ,</if>
            <if test="imageUrl != null and imageUrl != ''">            image_url               ,</if>
            <if test="type != null and type != ''">                    type                    ,</if>
            <if test="route != null and route != ''">                  route                   ,</if>
            <if test="sort != null">                                   sort                    ,</if>
            <if test="status != null and status != ''">                status                  ,</if>
            <if test="createBy != null">                               create_by               ,</if>
            <if test="remark != null and remark != ''">                remark                  ,</if>
            <if test="enterpriseId != null">                           tenant_id               ,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="Id != null and Id != 0">                         #{Id}                   ,</if>
            <if test="systemName != null and systemName != ''">        #{systemName}           ,</if>
            <if test="imageUrl != null and imageUrl != ''">            #{imageUrl}             ,</if>
            <if test="type != null and type != ''">                    #{type}                 ,</if>
            <if test="route != null and route != ''">                  #{route}                ,</if>
            <if test="sort != null">                                   #{sort}                 ,</if>
            <if test="status != null and status != ''">                #{status}               ,</if>
            <if test="createBy != null">                               #{createBy}             ,</if>
            <if test="remark != null and remark != ''">                #{remark}               ,</if>
            <if test="enterpriseId != null">                           #{enterpriseId}         ,</if>
        </trim>
    </insert>

    <update id="updateSystem" parameterType="SysSystem">
        update xy_system
        <trim prefix="SET" suffixOverrides=",">
            <if test="systemName != null and systemName != ''">        system_name = #{systemName}    ,</if>
            <if test="imageUrl != null and imageUrl != ''">            image_url = #{imageUrl}        ,</if>
            <if test="type != null and type != ''">                    type = #{type}                 ,</if>
            <if test="route != null and route != ''">                  route = #{route}               ,</if>
            <if test="sort != null">                                   sort = #{sort}                 ,</if>
            <if test="status != null and status != ''">                status = #{status}             ,</if>
            <if test="updateBy != null">                               update_by = #{updateBy}        ,</if>
            <if test="remark != null">                                 remark = #{remark}             ,</if>
        </trim>
        where system_id = #{systemId}
        <!-- 数据范围过滤 -->
        ${params.updateScope}
    </update>

    <update id="updateSystemStatus" parameterType="SysSystem">
        update xy_system
        <trim prefix="SET" suffixOverrides=",">
            <if test="status != null and status != ''">                status = #{status}             ,</if>
        </trim>
        where system_id = #{systemId}
        <!-- 数据范围过滤 -->
        ${params.updateScope}
    </update>

    <delete id="deleteSystemByIds" parameterType="SysSystem">
        update xy_system set del_flag = 1
        where system_id in
        <foreach item="systemId" collection="params.Ids" open="(" separator="," close=")">
            #{systemId}
        </foreach>
        <!-- 数据范围过滤 -->
        ${params.updateScope}
    </delete>
</mapper>
